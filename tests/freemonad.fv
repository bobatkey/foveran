sem : Desc → Set → Set ;
sem = elimD (λx → Set → Set)
            (λA X → A)
            (λX → X)
            (λF G semF semG X → semF X × semG X)
            (λF G semF semG X → semF X + semG X);

lift : (D : Desc) →
       (α : Set) →
       (Φ : α → Set 2) →
       sem D α →
       Set 2 ;
lift D α Φ = elimD (\D → sem D α → Set 2)
                   (\A x → Unit)
                   (\x → Φ x)
                   (\F G f g x → f (fst x) × g (snd x))
                   (\F G f g x → case x for d. Set 2 with
                                   { inl y → f y
                                   ; inr z → g z
                                   })
                   D;

––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
drop : (D : Desc) →
       (A : Set) →
       (x : sem D (µ D)) →
       lift D (µ D) (λx → A) x →
       sem D A ;
drop D A = elimD (λD' → (x : sem D' (µ D)) → lift D' (µ D) (λx → A) x → sem D' A)
                 (λA x u → x)
                 (λx a → a)
                 (λF G f g x a → «f (fst x) (fst a), g (snd x) (snd a)»)
                 (λF G f g x → case x for x. lift (F “+” G) (µ D) (λx → A) x → sem (F “+” G) A with
                                 { inl y → λa → inl (f y a)
                                 ; inr z → λa → inr (g z a)
                                 })
                 D;

cata : (D : Desc) → (α : Set) → (sem D α → α) → µ D → α ;
cata D α k = induction D (λx → α) (λx a → k (drop D α x a));

––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
DescFM : Desc → Set → Desc ;
DescFM D A = “K” A “+” D ;

FM : Desc → Set → Set ;
FM D A = µ (DescFM D A) ;

return : (D : Desc) → (A : Set) → A → FM D A ;
return D A a = construct (DescFM D A) (inl a) ;

bind : (D : Desc) → (A B : Set) → FM D A → (A → FM D B) → FM D B ;
bind D A B a f
  = cata (DescFM D A)
         (FM D B)
         (λx → case x for d. FM D B with
                 { inl a → f a
                 ; inr x → construct (DescFM D B) (inr x)
                 })
         a;

––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––––
– Now prove the laws...
